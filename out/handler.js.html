<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/handler.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: lib/handler.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*
 * Knotter Handler
 *
 * @author Patrice FERLET
 * @licence GPLv3
 * @module knotter/handler
 *
 */


/**
 * Handler that will match route to method.
 * This is the class to implement on project.
 * Minimum required is "route" and one of HTTP method
 * as get, post, put, delete...
 *
 * Handler has this properties to work:
 *
 *  - params.args => that matches regexp on url
 *  - params.get => options given by ?argname=argvalue&...
 *  - postdata => object having post data
 *  - response => to write response
 *  - request => the current request
 *
 * @class Handler
 * @constructor
 */
var Handler = function(){
    this.response = null;
    this.request = null;
    this.cookies = {};
};

/**
 * Property that handle arguments (GET and url parts)
 *
 * @property {Object} params
 * @default {args: [], get: {}}
 */
Handler.prototype.params = {args: [], get: {}};


/**
 * Postdata object that map datas sent via POST method
 *
 * @property {Object} postdata
 */
Handler.prototype.postdata = null;

/**
 * Route to handle (regexp)
 * 
 * @property {String} route
 */
Handler.prototype.route = null;

/**
 * GET method handler, to be set if handler should respond
 * to GET
 *
 * @method get
 * @default null
 */
Handler.prototype.get = null;

/**
 * POST method handler, to be set if handler should respond
 * to POST
 *
 * @method post
 * @default null
 */
Handler.prototype.post = null;

/**
 * PUT method handler, to be set if handler should respond
 * to PUT
 *
 * @method put
 * @default null
 */
Handler.prototype.put = null;

/**
 * DELETE method handler, to be set if handler should respond
 * to DELETE
 *
 * @method delete
 * @default null
 */
Handler.prototype['delete'] = null;

/**
 * HEAD method handler, to be set if handler should respond
 * to HEAD
 *
 * @method head
 * @default null
 */
Handler.prototype.head = null;

/**
 * Handler sessions.session to get/set values
 *
 * @property {Function} sessions
 * @throws Exception if useSessions is set to false
 */
Handler.prototype.sessions = function (){
    throw new Exception('sessions not activated for this handler');    
};

/**
 * Response handler, object taken from http.Response
 *
 * @property {http.Response} response
 */
Handler.prototype.response = null;

/**
 * Request handler, object taken from http.Request
 *
 * @property {http.Request} request
 */
Handler.prototype.request = null;

/**
 * Try to render given template with context. If no engine is configure
 * this method throws an exception
 *
 * @property {Function} render
 * @throws Exception if no engine
 */
Handler.prototype.render = function (template, context){
	throw "No configured engine";
};

/**
 * Alias to the "write" response method
 *
 * @method write
 * @param {string} content
 */
Handler.prototype.write = function (content) {
	return this.response.write(content)
}
/**
 * Alias to the "end" response method
 *
 * @method end
 * @param {string} content
 */
Handler.prototype.end = function (content) {
    this.sendCookies();
	return this.response.end(content)
}

/**
 * Cookies that will be sent
 *
 * @property cookies
 */
Handler.prototype.cookies = {}


/**
 * Initialize cookies property to be simplier to 
 * manage
 *
 * This is a critical security point there, cookies MUST be empty here
 *
 * @method initCookies
 */
Handler.prototype.initCookies = function (){
    var self = this;
    this.cookies = {};
    try {
            this.request.headers.cookie.split(";").forEach(function (c) {
                var cookie = c.split("=", 2)
                self.cookies[cookie[0].trim()] = cookie[1].trim() || true;
            });
    } catch (e) {
        this.cookies = {}
    }
}


/**
 * Send cookies to the headers
 *
 * @method sendCookies
 */
Handler.prototype.sendCookies = function (){

    if (this.response.headersSent) return
    try {
        var setcookies = [];
        for (var v in this.cookies) {
            setcookies.push(v+"="+this.cookies[v]+'; path=/');
        }
        this.response.setHeader('Set-Cookie', setcookies);
    } catch(e) {
    }
    this.cookies = null;

};

/**
 * Write header 
 *
 * @method writeHead
 */
Handler.prototype.writeHead = function (code, headers) {
    var c = code;
    var h = null;
    if (arguments.length &lt;2 ){
        h = {}
    } else {
        h = headers
    }

    this.response.setHeader('Connection', 'close');
    if (this.cookies != {}) 
        this.sendCookies()
    this.response.writeHead(c, h);


};

module.exports.Handler = Handler;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-knotter.html">knotter</a></li><li><a href="clusterutils.html">knotter/clusterutils</a></li><li><a href="handler.html">knotter/handler</a></li><li><a href="httpserver.html">knotter/httpserver</a></li><li><a href="sessions.html">knotter/sessions</a></li></ul><h3>Classes</h3><ul><li><a href="handler-Handler.html">Handler</a></li><li><a href="httpserver-Server.html">Server</a></li><li><a href="sessions-Session.html">Session</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addHandler">addHandler</a></li><li><a href="global.html#delete">delete</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getCookies">getCookies</a></li><li><a href="global.html#handle">handle</a></li><li><a href="global.html#head">head</a></li><li><a href="global.html#initCookies">initCookies</a></li><li><a href="global.html#launchHandler">launchHandler</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#put">put</a></li><li><a href="global.html#save">save</a></li><li><a href="global.html#sendCookies">sendCookies</a></li><li><a href="global.html#serve">serve</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setMessageSender">setMessageSender</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#write">write</a></li><li><a href="global.html#writeHead">writeHead</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Sat Apr 27 2013 10:51:56 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
